<!doctype html>
<html lang="en">
<head>
<meta charset="utf-8" />
<meta name="viewport" content="width=device-width,initial-scale=1" />
<title>Sports Club System</title>
<style>
  :root{ --bg:#f7f7f8; --card:#fff; --ink:#222; --muted:#6B7280; --line:#E5E7EB; --chip:#F3F4F6; }
  *{box-sizing:border-box}
  body{margin:0;background:linear-gradient(#fff,#fafafa);color:var(--ink);font:14px/1.5 system-ui,-apple-system,Segoe UI,Roboto,Helvetica,Arial}
  body.no-scroll{overflow:hidden}
  header{background:#fff;position:sticky;top:0;z-index:10;border:none;box-shadow:none}
  footer{border-top:1px solid var(--line);background:#fff;}
  header .wrap,footer .wrap,.wrap{max-width:1100px;margin:0 auto;padding:16px}
  h1{font-size:22px;margin:0}
  h3{font-size:15px;margin:8px 0}
  .btn{border:1px solid var(--line);background:#111;color:#fff;padding:8px 12px;border-radius:8px;font-size:13px;cursor:pointer}
  .btn.ghost{background:#fff;color:#111}
  .btn.blue{background:#2563eb;border-color:#2563eb}
  .user-pill{display:flex;align-items:center;gap:6px;background:#f3f4f6;border-radius:999px;padding:6px 12px;font-size:13px}
  .user-pill button{background:none;border:none;font-size:12px;cursor:pointer;color:#374151}
  .user-menu{position:relative;display:inline-block}
  .user-menu .menu{position:absolute;top:calc(100% + 4px);right:0;background:#fff;border:1px solid var(--line);border-radius:10px;box-shadow:0 12px 28px rgba(15,23,42,.12);padding:6px 0;display:none;min-width:140px;z-index:20}
  .user-menu .menu.open{display:block}
  .user-menu .menu button{width:100%;background:none;border:none;padding:8px 14px;text-align:left;font-size:13px;color:var(--ink);cursor:pointer}
  .user-menu .menu button:hover{background:#f3f4f6}
  .card{background:var(--card);border:1px solid var(--line);border-radius:16px;box-shadow:0 2px 8px rgba(0,0,0,.04)}
  .card .pad{padding:16px}
  .fields{display:grid;gap:10px;grid-template-columns:repeat(12,1fr);align-items:end}
  .field{grid-column:span 12}
  input.input{width:100%;height:36px;border-radius:8px;border:1px solid var(--line);background:#fff;padding:0 10px}
  .cards{display:grid;grid-template-columns:1fr;gap:12px;margin-top:16px}
  @media(min-width:640px){.cards{grid-template-columns:1fr 1fr}}
  .club{padding:12px}
  .thumb{height:96px;background:#f3f4f6;border:1px dashed var(--line);border-radius:10px;color:var(--muted);display:flex;align-items:center;justify-content:center}
  .page{padding:20px 0}
  .muted{color:var(--muted);font-size:12px}
  .toolbar{display:flex;gap:8px;margin-top:8px}
  .chips{display:flex;gap:8px;flex-wrap:wrap}
  .chip{background:var(--chip);border:1px solid var(--line);border-radius:999px;padding:4px 10px;font-size:12px}
  .empty{padding:16px;text-align:center;color:var(--muted)}
  h2{margin:0 0 4px;font-size:18px}
  .floating-search-btn{position:fixed;bottom:20px;right:20px;width:56px;height:56px;border-radius:999px;border:none;background:#2563eb;color:#fff;box-shadow:0 12px 30px rgba(37,99,235,.4);display:flex;align-items:center;justify-content:center;font-size:13px;font-weight:600;cursor:pointer;z-index:50;transition:transform .15s ease,box-shadow .15s ease}
  .floating-search-btn:hover{transform:translateY(-2px);box-shadow:0 16px 36px rgba(37,99,235,.45)}
  .search-overlay{position:fixed;inset:0;background:rgba(15,23,42,.45);backdrop-filter:blur(4px);display:none;align-items:center;justify-content:center;padding:16px;z-index:40}
  .search-overlay.open{display:flex}
  .search-dialog{background:#fff;border-radius:18px;box-shadow:0 24px 48px rgba(15,23,42,.2);width:min(560px,100%);padding:20px;display:flex;flex-direction:column;gap:14px}
  .search-header{display:flex;align-items:center;justify-content:space-between;gap:12px}
  .search-header h2{font-size:18px;margin:0}
  .search-header .close{background:none;border:none;color:var(--muted);font-size:20px;cursor:pointer;line-height:1;padding:0 6px}
  .search-overlay .search-form{display:flex;gap:10px;align-items:center}
  .search-overlay .search-form input{flex:1;height:40px;border-radius:10px;border:1px solid var(--line);padding:0 12px;font-size:14px}
  .search-overlay .search-actions{display:flex;gap:8px}
  .search-overlay .search-actions .btn{height:40px;display:flex;align-items:center}
  .search-hint{font-size:12px;color:var(--muted)}
  @media(max-width:480px){
    .floating-search-btn{width:52px;height:52px;right:16px;bottom:16px}
    .search-dialog{padding:16px}
    .search-overlay .search-form{flex-direction:column;align-items:stretch}
    .search-overlay .search-actions{justify-content:flex-end}
    .search-overlay .search-actions .btn{width:auto}
  }
</style>
</head>
<body>
  <header>
    <div class="wrap" style="display:flex;align-items:center;justify-content:space-between;gap:12px;border:none;box-shadow:none;">
      <h1 style="display:flex;align-items:center;">Sports Club System</h1>
      <div id="userArea" style="display:flex;align-items:center;gap:8px;margin-top:0">
        <button id="btnLogin" class="btn" type="button">Login</button>
        <button id="btnRegister" class="btn blue" type="button">Register</button>
      </div>
    </div>
  </header>

  <div class="wrap">
    <section id="p1" class="page">
      <div class="card"><div class="pad">
        <div class="fields" style="align-items:center">
          <div class="field" style="grid-column:span 8">
            <input id="kw" class="input" type="text" placeholder="Try: badminton, yoga, football..." />
          </div>
          <div class="field" style="grid-column:span 4;margin-top:-8px">
            <div style="display:flex;justify-content:flex-end;gap:8px;margin-top:8px">
              <button class="btn outline" type="button" id="btnSearch">Search</button>
              <button class="btn ghost" type="button" id="btnClear">Clear</button>
            </div>
          </div>
        </div>
      </div></div>

      <div id="cards" class="cards"></div>
      <div id="empty" class="empty" style="display:none">No clubs match your keyword.</div>
    </section>
  </div>

  <button id="globalSearchBtn" class="floating-search-btn" type="button" aria-haspopup="dialog" aria-controls="searchOverlay">Search</button>

  <div id="searchOverlay" class="search-overlay" role="dialog" aria-modal="true" aria-hidden="true">
    <div class="search-dialog">
      <div class="search-header">
        <h2>Search clubs</h2>
        <button id="closeSearchBtn" class="close" type="button" aria-label="Close search">×</button>
      </div>
      <form class="search-form" role="search" id="searchFormOverlay">
        <input id="kwOverlay" class="input" type="search" placeholder="Try: badminton, yoga, football..." autocomplete="off" />
        <div class="search-actions">
          <button class="btn outline" type="submit" id="btnSearchOverlay">Search</button>
          <button class="btn ghost" type="button" id="btnClearOverlay">Clear</button>
        </div>
      </form>
      <div class="search-hint">Press Enter to search · Esc to close</div>
    </div>
  </div>

  <footer>
    <div class="wrap" style="display:flex;justify-content:space-between;align-items:center">
      <span class="muted">© <span id="y"></span> Sports Club System</span>
      <div class="chips"><span class="chip">Privacy</span><span class="chip">Terms</span><span class="chip">Help</span></div>
    </div>
  </footer>

  <script>
document.addEventListener('DOMContentLoaded', () => {
  // footer year
  const yEl = document.getElementById('y');
  if (yEl) yEl.textContent = new Date().getFullYear();

  const userArea = document.getElementById('userArea');
  let savedUser = null;
  // ❗安全读取，防止 JSON 解析失败导致后续代码都不执行 → 按钮点不了
  try {
    savedUser = JSON.parse(localStorage.getItem('loggedUser') || 'null');
  } catch (e) {
    savedUser = null;
    localStorage.removeItem('loggedUser');
  }

  // ---------- header auth area ----------
  if (savedUser) {
    const isClub = (savedUser && savedUser.type) === 'club';
    const targetHref = isClub ? 'club.html' : 'user.html';
    const myLabel = isClub ? 'Club' : 'My';
    userArea.innerHTML = `
      <div class="user-menu">
        <button id="btnMy" class="btn blue" type="button" aria-haspopup="true" aria-expanded="false">${myLabel}</button>
        <div class="menu" id="myMenu" role="menu">
          <button type="button" id="btnDetails" role="menuitem">Details</button>
          <button type="button" id="btnLogout" role="menuitem">Logout</button>
        </div>
      </div>`;

    const myBtn = document.getElementById('btnMy');
    const menuEl = document.getElementById('myMenu');
    const detailsBtn = document.getElementById('btnDetails');
    const logoutBtn = document.getElementById('btnLogout');

    if (detailsBtn) {
      detailsBtn.addEventListener('click', () => {
        window.location.href = targetHref;
      });
    }

    if (logoutBtn) {
      logoutBtn.addEventListener('click', () => {
        localStorage.removeItem('loggedUser');
        location.reload();
      });
    }

    if (myBtn && menuEl) {
      let closeTimer = null;
      const wrapper = userArea.querySelector('.user-menu');
      const CLOSE_DELAY = 400;

      const clearCloseTimer = () => {
        if (closeTimer) {
          clearTimeout(closeTimer);
          closeTimer = null;
        }
      };

      const openMenu = () => {
        clearCloseTimer();
        menuEl.classList.add('open');
        myBtn.setAttribute('aria-expanded', 'true');
      };

      const closeMenu = () => {
        clearCloseTimer();
        menuEl.classList.remove('open');
        myBtn.setAttribute('aria-expanded', 'false');
      };

      const scheduleClose = (delay = CLOSE_DELAY) => {
        clearCloseTimer();
        closeTimer = window.setTimeout(() => {
          menuEl.classList.remove('open');
          myBtn.setAttribute('aria-expanded', 'false');
          closeTimer = null;
        }, delay);
      };

      myBtn.addEventListener('click', (evt) => {
        evt.preventDefault();
        if (menuEl.classList.contains('open')) {
          closeMenu();
        } else {
          openMenu();
        }
      });

      myBtn.addEventListener('focus', openMenu);
      myBtn.addEventListener('mouseenter', openMenu);
      myBtn.addEventListener('keydown', (evt) => {
        if (evt.key === 'Escape') {
          closeMenu();
          myBtn.blur();
        }
      });

      menuEl.addEventListener('focusin', openMenu);
      menuEl.addEventListener('mouseenter', openMenu);
      menuEl.addEventListener('mouseleave', () => scheduleClose());
      menuEl.addEventListener('keydown', (evt) => {
        if (evt.key === 'Escape') {
          closeMenu();
          myBtn.focus();
        }
      });

      if (wrapper) {
        wrapper.addEventListener('mouseenter', openMenu);
        wrapper.addEventListener('mouseleave', () => scheduleClose());
      }

      document.addEventListener('click', (evt) => {
        if (!wrapper || wrapper.contains(evt.target)) {
          return;
        }
        closeMenu();
      });
    }
  } else {
    const loginBtn = document.getElementById('btnLogin');
    const registerBtn = document.getElementById('btnRegister');
    if (loginBtn) loginBtn.addEventListener('click', () => window.location.href = 'login.html#login');
    if (registerBtn) registerBtn.addEventListener('click', () => window.location.href = 'login.html#register');
  }

  // ---------- 固定 20 个俱乐部（保持原来数量） ----------
  const LOCAL_CLUBS = [
    { id:'badminton', name:'Club 1', tags:['badminton'], desc:'Suitable for all levels, regular evening training and friendlies.' },
    { id:'basketball', name:'Club 2', tags:['basketball'], desc:'Varsity training + amateur matches, new members welcome.' },
    { id:'football', name:'Club 3', tags:['football'], desc:'Weekly matches and local tournaments, join our squad!' },
    { id:'yoga', name:'Club 4', tags:['yoga'], desc:'Relax and strengthen your body and mind, small group sessions.' },
    { id:'tennis', name:'Club 5', tags:['tennis'], desc:'Book your court and join tournaments or casual games.' },
    { id:'volleyball', name:'Club 6', tags:['volleyball'], desc:'Indoor and beach volleyball activities for all skill levels.' },
    { id:'cycling', name:'Club 7', tags:['cycling'], desc:'Weekend city rides and countryside cycling challenges.' },
    { id:'swimming', name:'Club 8', tags:['swimming'], desc:'Morning and evening sessions available, professional coach guidance.' },
    { id:'running', name:'Club 9', tags:['running'], desc:'Morning jogs, half marathons, and social running events.' },
    { id:'fitness', name:'Club 10', tags:['fitness'], desc:'State-of-the-art gym equipment and personalized workout plans.' },
    { id:'dance', name:'Club 11', tags:['dance'], desc:'Learn hip-hop, jazz, and modern dance from experienced instructors.' },
    { id:'badminton-east', name:'Club 12', tags:['badminton'], desc:'East campus sessions, beginner friendly with spare rackets.' },
    { id:'badminton-social', name:'Club 13', tags:['badminton'], desc:'Casual games, social mix-ins on Fridays.' },
    { id:'yoga-ii', name:'Club 14', tags:['yoga'], desc:'Intermediate vinyasa and power yoga classes.' },
    { id:'yoga-sunrise', name:'Club 15', tags:['yoga'], desc:'Sunrise outdoor yoga, mats provided.' },
    { id:'football-evening', name:'Club 16', tags:['football'], desc:'Evening league matches, 7-a-side format.' },
    { id:'football-academy', name:'Club 17', tags:['football'], desc:'Skill drills and coaching for developing players.' },
    { id:'tabletennis', name:'Club 18', tags:['table tennis'], desc:'Weekend open training, tables and equipment provided.' },
    { id:'tennis-advanced', name:'Club 19', tags:['tennis'], desc:'Advanced ladder matches and coaching clinics.' },
    { id:'tennis-social', name:'Club 20', tags:['tennis'], desc:'Casual doubles and weekend socials.' }
  ];

  let CLUBS = [...LOCAL_CLUBS];
  const cardsEl = document.getElementById('cards');
  const emptyEl = document.getElementById('empty');
  const kwEl = document.getElementById('kw');

  // 保存开始输入前的视图，以便清空时恢复到“之前浏览过的页面”
  let beforeSearchView = null;
  let searching = false;
  function snapshotView(){
    beforeSearchView = {
      cardsHTML: cardsEl.innerHTML,
      emptyDisplay: emptyEl.style.display
    };
  }
  function restoreView(){
    if(beforeSearchView){
      cardsEl.innerHTML = beforeSearchView.cardsHTML;
      emptyEl.style.display = beforeSearchView.emptyDisplay;
    } else {
      // 没有历史则回退到默认列表
      render(CLUBS);
    }
  }

  function getSportType(c){
    return (c.tags && c.tags.length) ? c.tags[0] : 'sport';
  }

  function clubCard(c){
    const sport = getSportType(c);
    return `
      <div class="card club" data-id="${c.id}">
        <div class="thumb">Cover</div>
        <h3>${c.name}</h3>
        <p class="muted">${c.desc}</p >
        <div class="chips"><span class="chip"># ${sport}</span></div>
        <div class="toolbar">
          <button class="btn">Join Now</button>
          <button class="btn ghost">View Details</button>
        </div>
      </div>`;
  }

  function render(list){
    if(!list.length){
      cardsEl.innerHTML = '';
      emptyEl.style.display = 'block';
    } else {
      emptyEl.style.display = 'none';
      cardsEl.innerHTML = list.map(c=>clubCard(c)).join('');
    }
  }

  function normalize(s){ return (s || '').toLowerCase().trim(); }

  function filterResults(){
    const q = normalize(kwEl.value);
    if(!q){ render(CLUBS); return; }

    const list = CLUBS.filter(c => {
      const nameMatch = normalize(c.name).includes(q);
      const tagMatch  = (c.tags||[]).some(t => normalize(t).includes(q));
      // 支持输入 "1" → Club 1
      const numberMatch = (`club ${q}` === c.name.toLowerCase());
      return nameMatch || tagMatch || numberMatch;
    });

    render(list);
  }

  document.getElementById('btnSearch').addEventListener('click', filterResults);
  document.getElementById('btnClear').addEventListener('click', ()=>{
    kwEl.value='';
    restoreView();
    searching = false;
    kwEl.focus();
  });
  kwEl.addEventListener('keydown', (e)=>{ if(e.key==='Enter'){ filterResults(); } });

  // 输入过程中（包含删除键）实时过滤；清空后恢复“之前浏览过的页面”
  kwEl.addEventListener('input', ()=>{
    const q = normalize(kwEl.value);
    if(q){
      if(!searching){
        snapshotView();
        searching = true;
      }
      filterResults();
    } else {
      restoreView();
      searching = false;
    }
  });

  // 初次渲染 20 个俱乐部
  render(CLUBS);
});
</script>
</body>
</html>
