<!doctype html>
<html lang="en">
<head>
  <meta charset="utf-8">
  <meta name="viewport" content="width=device-width,initial-scale=1">
  <title>Club Booking Portal - Member Bookings</title>
  <link rel="stylesheet" href="theme.css">
  <style>
    body { margin: 0; background: #f8f9fa; }
    header { 
      position: sticky; 
      top: 0; 
      z-index: 10; 
      border-bottom: 1px solid rgba(15, 23, 42, 0.06); 
      background: #fff;
    }
    .wrap { max-width: 1100px; margin: 0 auto; padding: 16px; }
    .header-wrap { 
      display: flex; 
      align-items: center; 
      justify-content: space-between; 
      gap: 12px; 
    }
    .header-actions { 
      display: flex; 
      align-items: center; 
      gap: 8px; 
    }
    .back-link {
      display: inline-flex;
      align-items: center;
      gap: 6px;
      font-size: 14px;
      color: #0066cc;
      text-decoration: none;
      border: none;
      background: none;
      cursor: pointer;
      padding: 8px 0;
    }
    .site-title-link { 
      color: inherit; 
      text-decoration: none; 
      font-weight: 700;
    }
    .page-head { 
      display: flex; 
      align-items: center; 
      justify-content: space-between; 
      gap: 16px; 
      margin: 20px 0 16px; 
      flex-wrap: wrap;
    }
    .page-head h2 { 
      margin: 0; 
      font-size: 28px;
    }
    .page-head p { 
      margin: 4px 0 0; 
      color: var(--muted);
    }
    .card .pad { padding: 16px; }
    .stat-grid { display: grid; grid-template-columns: repeat(auto-fit, minmax(140px, 1fr)); gap: 12px; }
    .stat-card { border: 1px solid var(--line); border-radius: 12px; padding: 12px; background: #fff; }
    .stat-label { display: block; font-size: 12px; color: var(--muted); }
    .stat-value { display: block; font-size: 20px; font-weight: 700; margin-top: 4px; }
    .filter-row { display: flex; gap: 8px; flex-wrap: wrap; margin-top: 12px; }
    .filter-btn { 
      border: none; 
      background: transparent; 
      color: var(--muted); 
      padding: 8px 14px;
      border-radius: 8px;
      font-size: 13px;
      font-weight: 500;
      cursor: pointer;
      transition: all 0.2s ease;
    }
    .filter-btn:hover {
      background: rgba(15, 23, 42, 0.06);
      color: var(--ink);
    }
    .filter-btn.active { 
      background: #2563eb;
      color: #fff;
    }
    .list { margin-top: 16px; display: grid; gap: 12px; }
    .booking-card { 
      display: grid;
      grid-template-columns: 1fr auto 1fr;
      align-items: center;
      gap: 24px;
      padding: 16px;
      background: #fff;
      border: 1px solid rgba(15, 23, 42, 0.06);
      border-radius: 14px;
      transition: all 0.2s ease;
    }
    .booking-card:hover {
      border-color: rgba(15, 23, 42, 0.12);
      background: #fafbfc;
    }
    .booking-meta { display: grid; gap: 4px; }
    .booking-meta:nth-child(2) {
      display: flex;
      align-items: center;
      justify-content: center;
    }
    .booking-meta:nth-child(3) {
      justify-self: end;
    }
    .booking-actions { 
      display: flex; 
      gap: 8px; 
      flex-wrap: wrap;
      justify-content: flex-end;
    }
    .status { 
      font-size: 12px; 
      font-weight: 600; 
      padding: 6px 12px; 
      border-radius: 8px; 
      border: none;
      text-align: left;
      width: 100px;
      display: inline-block;
    }
    .status.pending { background: #fef3c7; color: #b45309; }
    .status.approved { background: #dcfce7; color: #16a34a; }
    .status.checked { background: #dbeafe; color: #2563eb; }
    .status.cancelled { background: #fee2e2; color: #dc2626; }
    .booking-title { font-weight: 700; font-size: 15px; }
    .booking-sub { color: var(--muted); font-size: 13px; }
    .group-section {
      margin-bottom: 24px;
    }
    .group-header {
      font-size: 16px;
      font-weight: 700;
      margin-bottom: 12px;
      padding: 10px 14px;
      background: #f8f9fa;
      border-radius: 8px;
      color: var(--ink);
    }
    .group-list {
      display: grid;
      gap: 12px;
    }
    .btn {
      border-radius: 8px;
      padding: 8px 14px;
      font-size: 13px;
      font-weight: 600;
      text-decoration: none;
      display: inline-flex;
      align-items: center;
      justify-content: center;
      border: none;
      background: #f1f3f5;
      color: #1e293b;
      cursor: pointer;
      transition: all 0.2s ease;
      box-shadow: none;
    }
    .btn:hover {
      background: #e3e6e9;
      transform: translateY(0);
      box-shadow: none;
    }
    .btn:active {
      background: #d4d8dc;
      transform: translateY(0);
      box-shadow: none;
    }
    .btn.blue {
      background: #f1f3f5;
      color: #1e293b;
    }
    .btn.blue:hover {
      background: #e3e6e9;
      box-shadow: none;
    }
    .btn.approve {
      background: #f1f3f5;
      color: #1e293b;
    }
    .btn.approve:hover {
      background: #e3e6e9;
      box-shadow: none;
    }
    .btn.checkin {
      background: #f1f3f5;
      color: #1e293b;
    }
    .btn.checkin:hover {
      background: #e3e6e9;
      box-shadow: none;
    }
    .btn.cancel {
      background: #f1f3f5;
      color: #1e293b;
    }
    .btn.cancel:hover {
      background: #e3e6e9;
      box-shadow: none;
    }
    .btn.ghost {
      background: transparent;
      color: var(--muted);
      border: 1px solid rgba(15, 23, 42, 0.1);
    }
    .btn.ghost:hover {
      color: var(--ink);
      background: rgba(15, 23, 42, 0.04);
    }
    .btn.small { padding: 6px 12px; font-size: 12px; }
    .info-overlay {
      position: fixed;
      inset: 0;
      display: none;
      align-items: center;
      justify-content: center;
      padding: 24px;
      background: rgba(10, 12, 16, 0.45);
      z-index: 3000;
    }
    .info-overlay.open { display: flex; }
    .info-card {
      position: relative;
      width: min(560px, 92vw);
      background: #fff;
      border-radius: 16px;
      box-shadow: none;
      padding: 20px 20px 18px;
    }
    .info-card h3 { margin: 0 0 8px; font-size: 18px; }
    .info-body p { margin: 0 0 10px; color: var(--muted); font-size: 13px; }
    .info-close {
      position: absolute;
      top: 10px;
      right: 10px;
      width: 30px;
      height: 30px;
      border-radius: 999px;
      border: 1px solid var(--line);
      background: #fff;
      cursor: pointer;
      color: var(--muted);
    }
    @media (max-width: 720px) {
      .booking-card { flex-direction: column; align-items: flex-start; }
      .booking-actions { width: 100%; }
      .header-actions { flex-wrap: wrap; }
    }
  </style>
</head>
<body>
  <header>
    <div class="wrap header-wrap" style="display: grid; grid-template-columns: 1fr auto 1fr; align-items: center; gap: 16px;">
      <div style="display: flex; align-items: center; gap: 16px;">
        <button class="back-link" onclick="window.location.href = 'club home.html'" type="button" aria-label="Back">← Back</button>
      </div>
      <h2 style="margin: 0; font-size: 18px; font-weight: 600; justify-self: center;">Member bookings</h2>
      <div class="header-actions" style="justify-self: end;">
        <button id="refreshBtn" class="btn" type="button" style="min-width:100px">Refresh</button>
      </div>
    </div>
  </header>

  <main class="wrap">
    <section class="card">
      <div class="pad">
        <div class="stat-grid" id="stats">
          <div class="stat-card">
            <span class="stat-label">Pending</span>
            <span class="stat-value" data-stat="pending">0</span>
          </div>
          <div class="stat-card">
            <span class="stat-label">Approved</span>
            <span class="stat-value" data-stat="approved">0</span>
          </div>
          <div class="stat-card">
            <span class="stat-label">Checked-in</span>
            <span class="stat-value" data-stat="checked">0</span>
          </div>
          <div class="stat-card">
            <span class="stat-label">Cancelled</span>
            <span class="stat-value" data-stat="cancelled">0</span>
          </div>
        </div>

        <div style="display: flex; align-items: center; gap: 12px; margin-top: 16px; padding-top: 16px; border-top: 1px solid rgba(15, 23, 42, 0.06);">
          <span style="font-size: 13px; font-weight: 600; color: var(--muted);">View by:</span>
          <div class="filter-row" id="viewModeRow" style="margin-top: 0;">
            <button class="btn ghost filter-btn active" type="button" data-view="status">Status</button>
            <button class="btn ghost filter-btn" type="button" data-view="venue">Venue</button>
            <button class="btn ghost filter-btn" type="button" data-view="time">Time</button>
          </div>
        </div>

        <div id="sportTypeFilter" style="display: none; margin-top: 12px;">
          <span style="font-size: 13px; font-weight: 600; color: var(--muted);">Sport type:</span>
          <div class="filter-row" style="margin-top: 8px;">
            <button class="btn ghost filter-btn active" type="button" data-sport="all">All</button>
            <button class="btn ghost filter-btn" type="button" data-sport="basketball">Basketball</button>
            <button class="btn ghost filter-btn" type="button" data-sport="tabletennis">Table Tennis</button>
          </div>
        </div>
      </div>
    </section>

    <div class="list" id="bookingList"></div>
    <div class="list" id="groupedView" style="display: none;"></div>
    <div id="empty" class="muted" style="display:none;padding:12px;">No bookings found.</div>
  </main>

  <footer class="site-footer">
    <div class="site-footer__wrap">
      <span class="site-footer__text">&copy; 2026 Club Booking Portal</span>
      <div class="site-footer__actions">
        <button class="site-footer__btn info-trigger" type="button" data-info="privacy">Privacy</button>
        <button class="site-footer__btn info-trigger" type="button" data-info="terms">Terms</button>
        <button class="site-footer__btn info-trigger" type="button" data-info="help">Help</button>
      </div>
    </div>
  </footer>

  <div id="infoOverlay" class="info-overlay" aria-hidden="true">
    <div class="info-card" role="dialog" aria-modal="true" aria-labelledby="infoTitle">
      <button class="info-close" type="button" aria-label="Close">×</button>
      <h3 id="infoTitle">Privacy</h3>
      <div id="infoBody" class="info-body"></div>
    </div>
  </div>

  <script>
    const STORAGE_KEY = 'clubBookings';
    const defaultBookings = [
      { id: 1, member: 'Alex Chen', session: 'Basketball · Court A', time: '2026-01-27 18:00-19:00', status: 'pending' },
      { id: 2, member: 'Mia Zhang', session: 'Table Tennis · Hall 1', time: '2026-01-27 19:00-20:00', status: 'approved' },
      { id: 3, member: 'Sam Lee', session: 'Basketball · Court B', time: '2026-01-28 10:00-11:00', status: 'checked' },
      { id: 4, member: 'Chris Wu', session: 'Table Tennis · Hall 2', time: '2026-01-28 12:00-13:00', status: 'cancelled' },
      { id: 5, member: 'Emma Davis', session: 'Basketball · Court C', time: '2026-01-27 15:00-16:00', status: 'approved' },
      { id: 6, member: 'John Smith', session: 'Table Tennis · Hall 2', time: '2026-01-27 16:00-17:00', status: 'approved' }
    ];

    const listEl = document.getElementById('bookingList');
    const groupedView = document.getElementById('groupedView');
    const emptyEl = document.getElementById('empty');
    const viewModeRow = document.getElementById('viewModeRow');
    const sportTypeFilter = document.getElementById('sportTypeFilter');
    const refreshBtn = document.getElementById('refreshBtn');

    let currentSportFilter = 'all';

    const loadBookings = () => {
      try {
        const stored = JSON.parse(localStorage.getItem(STORAGE_KEY) || 'null');
        if (Array.isArray(stored) && stored.length) return stored;
      } catch (e) { /* ignore */ }
      localStorage.setItem(STORAGE_KEY, JSON.stringify(defaultBookings));
      return defaultBookings.slice();
    };

    const saveBookings = (items) => {
      localStorage.setItem(STORAGE_KEY, JSON.stringify(items));
    };

    const statusLabel = (status) => ({
      pending: 'Pending',
      approved: 'Approved',
      checked: 'Checked-in',
      cancelled: 'Cancelled'
    }[status] || 'Pending');

    const renderStats = (items) => {
      const counts = { pending: 0, approved: 0, checked: 0, cancelled: 0 };
      items.forEach((item) => { if (counts[item.status] !== undefined) counts[item.status] += 1; });
      Object.keys(counts).forEach((key) => {
        const el = document.querySelector(`[data-stat="${key}"]`);
        if (el) el.textContent = String(counts[key]);
      });
    };

    const renderList = (items, filter = 'all') => {
      if (!listEl || !emptyEl) return;
      listEl.innerHTML = '';
      const statusOrder = { pending: 0, approved: 1, checked: 2, cancelled: 3 };
      const filtered = (filter === 'all' ? items : items.filter((item) => item.status === filter))
        .slice()
        .sort((a, b) => (statusOrder[a.status] ?? 99) - (statusOrder[b.status] ?? 99));
      emptyEl.style.display = filtered.length ? 'none' : 'block';
      filtered.forEach((item) => {
        const card = document.createElement('div');
        card.className = 'card booking-card';
        card.dataset.id = String(item.id);
        card.innerHTML = `
          <div class="booking-meta">
            <div class="booking-title">${item.member}</div>
            <div class="booking-sub">${item.session}</div>
            <div class="booking-sub">${item.time}</div>
          </div>
          <div class="booking-meta">
            <span class="status ${item.status}">${statusLabel(item.status)}</span>
          </div>
          <div class="booking-actions">
            <button class="btn approve small" data-action="approve">Approve</button>
            <button class="btn checkin small" data-action="checkin">Check-in</button>
            <button class="btn cancel small" data-action="cancel">Cancel</button>
          </div>
        `;
        listEl.appendChild(card);
      });
    };

    const renderGroupedView = (items, groupBy) => {
      if (!groupedView) return;
      groupedView.innerHTML = '';
      
      // Filter by sport type if viewing by venue
      let filteredItems = items;
      if (groupBy === 'venue') {
        filteredItems = items.filter(item => {
          if (currentSportFilter === 'all') return true;
          if (currentSportFilter === 'basketball') return item.session.includes('Basketball');
          if (currentSportFilter === 'tabletennis') return item.session.includes('Table Tennis');
          return true;
        });
      }
      
      let groups = {};
      
      if (groupBy === 'venue') {
        filteredItems.forEach(item => {
          const venue = item.session.split(' · ')[1] || 'Unknown';
          if (!groups[venue]) groups[venue] = [];
          groups[venue].push(item);
        });
        
        // Sort venues: Basketball courts (A, B, C, ...) first, then Table Tennis halls (1, 2, 3, ...)
        const venueOrder = (a, b) => {
          const isCourtA = /^Court/.test(a);
          const isCourtB = /^Court/.test(b);
          
          if (isCourtA && isCourtB) {
            // Both courts: sort alphabetically (A < B < C)
            return a.localeCompare(b);
          } else if (!isCourtA && !isCourtB) {
            // Both halls: sort numerically
            const numA = parseInt(a.match(/\d+/)?.[0] || 0);
            const numB = parseInt(b.match(/\d+/)?.[0] || 0);
            return numA - numB;
          }
          // Courts come before Halls
          return isCourtA ? -1 : 1;
        };
        
        Object.keys(groups).sort(venueOrder).forEach(groupName => {
          const section = document.createElement('div');
          section.className = 'group-section';
          
          const header = document.createElement('div');
          header.className = 'group-header';
          header.textContent = `Venue: ${groupName}`;
          section.appendChild(header);
          
          const groupList = document.createElement('div');
          groupList.className = 'group-list';
          
          groups[groupName].forEach(item => {
            const card = document.createElement('div');
            card.className = 'card booking-card';
            card.dataset.id = String(item.id);
            card.innerHTML = `
              <div class="booking-meta">
                <div class="booking-title">${item.member}</div>
                <div class="booking-sub">${item.session}</div>
                <div class="booking-sub">${item.time}</div>
              </div>
              <div class="booking-meta">
                <span class="status ${item.status}">${statusLabel(item.status)}</span>
              </div>
              <div class="booking-actions">
                <button class="btn approve small" data-action="approve">Approve</button>
                <button class="btn checkin small" data-action="checkin">Check-in</button>
                <button class="btn cancel small" data-action="cancel">Cancel</button>
              </div>
            `;
            groupList.appendChild(card);
          });
          
          section.appendChild(groupList);
          groupedView.appendChild(section);
        });
      } else if (groupBy === 'time') {
        items.forEach(item => {
          const date = item.time.split(' ')[0];
          if (!groups[date]) groups[date] = [];
          groups[date].push(item);
        });
        
        Object.keys(groups).sort().forEach(groupName => {
          const section = document.createElement('div');
          section.className = 'group-section';
          
          const header = document.createElement('div');
          header.className = 'group-header';
          header.textContent = `Date: ${groupName}`;
          section.appendChild(header);
          
          const groupList = document.createElement('div');
          groupList.className = 'group-list';
          
          groups[groupName].forEach(item => {
            const card = document.createElement('div');
            card.className = 'card booking-card';
            card.dataset.id = String(item.id);
            card.innerHTML = `
              <div class="booking-meta">
                <div class="booking-title">${item.member}</div>
                <div class="booking-sub">${item.session}</div>
                <div class="booking-sub">${item.time}</div>
              </div>
              <div class="booking-meta">
                <span class="status ${item.status}">${statusLabel(item.status)}</span>
              </div>
              <div class="booking-actions">
                <button class="btn approve small" data-action="approve">Approve</button>
                <button class="btn checkin small" data-action="checkin">Check-in</button>
                <button class="btn cancel small" data-action="cancel">Cancel</button>
              </div>
            `;
            groupList.appendChild(card);
          });
          
          section.appendChild(groupList);
          groupedView.appendChild(section);
        });
      }
    };

    let bookings = loadBookings();
    let viewMode = 'status';
    renderStats(bookings);
    renderList(bookings, 'all');

    refreshBtn?.addEventListener('click', () => {
      localStorage.setItem(STORAGE_KEY, JSON.stringify(defaultBookings));
      bookings = defaultBookings.slice();
      renderStats(bookings);
      if (viewMode === 'status') {
        renderList(bookings, 'all');
      } else {
        renderGroupedView(bookings, viewMode);
      }
    });

    viewModeRow?.addEventListener('click', (event) => {
      const btn = event.target.closest('.filter-btn');
      if (!btn) return;
      viewMode = btn.dataset.view || 'status';
      viewModeRow.querySelectorAll('.filter-btn').forEach((el) => el.classList.toggle('active', el === btn));
      
      // Show/hide sport type filter based on view mode
      sportTypeFilter.style.display = viewMode === 'venue' ? 'block' : 'none';
      
      if (viewMode === 'status') {
        listEl.style.display = 'grid';
        groupedView.style.display = 'none';
        renderList(bookings, 'all');
      } else {
        listEl.style.display = 'none';
        groupedView.style.display = 'block';
        renderGroupedView(bookings, viewMode);
      }
    });

    // Sport type filter for venue view
    document.getElementById('sportTypeFilter')?.addEventListener('click', (event) => {
      const btn = event.target.closest('.filter-btn');
      if (!btn) return;
      currentSportFilter = btn.dataset.sport || 'all';
      document.querySelectorAll('#sportTypeFilter .filter-btn').forEach((el) => {
        el.classList.toggle('active', el === btn);
      });
      renderGroupedView(bookings, 'venue');
    });

    listEl?.addEventListener('click', (event) => {
      const btn = event.target.closest('button[data-action]');
      const card = event.target.closest('.booking-card');
      if (!btn || !card) return;
      const id = Number(card.dataset.id);
      const action = btn.dataset.action;
      const item = bookings.find((b) => b.id === id);
      if (!item) return;
      if (action === 'approve') item.status = 'approved';
      if (action === 'checkin') item.status = 'checked';
      if (action === 'cancel') item.status = 'cancelled';
      saveBookings(bookings);
      renderStats(bookings);
      if (viewMode === 'status') {
        renderList(bookings, 'all');
      } else {
        renderGroupedView(bookings, viewMode);
      }
    });

    groupedView?.addEventListener('click', (event) => {
      const btn = event.target.closest('button[data-action]');
      const card = event.target.closest('.booking-card');
      if (!btn || !card) return;
      const id = Number(card.dataset.id);
      const action = btn.dataset.action;
      const item = bookings.find((b) => b.id === id);
      if (!item) return;
      if (action === 'approve') item.status = 'approved';
      else if (action === 'checkin') item.status = 'checked';
      else if (action === 'cancel') item.status = 'cancelled';
      saveBookings(bookings);
      renderStats(bookings);
      renderGroupedView(bookings, viewMode);
    });

    refreshBtn?.addEventListener('click', () => {
      bookings = loadBookings();
      renderStats(bookings);
      renderList(bookings, activeFilter);
    });

    const infoOverlay = document.getElementById('infoOverlay');
    const infoTitle = document.getElementById('infoTitle');
    const infoBody = document.getElementById('infoBody');
    const infoMap = {
      privacy: {
        title: 'Privacy',
        body: `
          <p>We only store the information needed to manage bookings and memberships.</p>
          <p>Your account data is kept locally in this demo and is not shared with third parties.</p>
          <p>You can request deletion at any time by contacting the admin.</p>
        `
      },
      terms: {
        title: 'Terms',
        body: `
          <p>Bookings are first-come, first-served and subject to club capacity.</p>
          <p>Members must follow club rules and respect facility policies.</p>
          <p>Repeated no-shows may result in booking restrictions.</p>
        `
      },
      help: {
        title: 'Help',
        body: `
          <p>Review pending requests daily to keep schedules accurate.</p>
          <p>Use Check-in once the member arrives on site.</p>
          <p>Contact support at support@example.com for further help.</p>
        `
      }
    };

    const openInfo = (key) => {
      const data = infoMap[key];
      if (!data || !infoOverlay) return;
      if (infoTitle) infoTitle.textContent = data.title;
      if (infoBody) infoBody.innerHTML = data.body;
      infoOverlay.classList.add('open');
      document.body.classList.add('no-scroll');
    };

    const closeInfo = () => {
      if (!infoOverlay) return;
      infoOverlay.classList.remove('open');
      document.body.classList.remove('no-scroll');
    };

    document.querySelectorAll('.info-trigger').forEach((btn) => {
      btn.addEventListener('click', () => openInfo(btn.dataset.info));
    });
    infoOverlay?.addEventListener('click', (evt) => { if (evt.target === infoOverlay) closeInfo(); });
    infoOverlay?.querySelector('.info-close')?.addEventListener('click', closeInfo);
  </script>
</body>
</html>
